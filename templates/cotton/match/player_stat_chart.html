<c-vars id="player-stat-chart" />

<canvas id="{{ id }}">
</canvas>

<div class="flex gap-x-1 gap-y-1 flex-wrap">
  <button class="btn btn-default total_gold">Gold</button>
  <button class="btn btn-default total_damage_done_to_champions">Champion DMG</button>
  <button class="btn btn-default total_damage_taken">DMG Taken</button>
  <button class="btn btn-default xp">XP</button>
  <button class="btn btn-default level">Level</button>
  <button class="btn btn-default attack_speed">Attack Speed</button>
  <button class="btn btn-default attack_damage">AD</button>
  <button class="btn btn-default armor">Armor</button>
  <button class="btn btn-default magic_resist">MR</button>
</div>
<script>
  (function() {
    const data = window.framesList.map(frame => {
      const parts = {};
      for (const p of frame.participantframes) {
        parts[parseInt(p.participant_id)] = p;
      }
      return parts
    })
    console.log(data[0])
    const pids = Object.keys(data?.[0] || {})
    let chart = null;
    function buildChart(statKey) {
      if (chart) {
        chart.destroy();
      }
      chart = new Chart(
        document.getElementById('{{ id }}'),
        {
          options: {
            aspectRatio: 1.5,
          },
          type: 'line',
          data: {
            labels: data.map((x, i) => `${i + 1}m`),
            datasets: pids.map(pid => {
              return {
                label: `Participant ${pid}`,
                data: data.map(x => x[pid][statKey]),
              }
            }),
          },
        }
      );
    }
    buildChart('total_damage_done_to_champions')

    const stats = [
      'total_gold',
      'total_damage_done_to_champions',
      'attack_speed',
      'attack_damage',
      'armor',
      'total_damage_taken',
      'level',
      'xp',
      'magic_resist',
    ]
    for (const stat of stats) {
      for (const el of document.querySelectorAll(`.${stat}`)) {
        el.addEventListener('click', () => buildChart(stat));
      }
    }

  })()
</script>
